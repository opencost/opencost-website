---
sidebar_position: 1
---
import InstallPrometheus from './_install_prometheus.mdx';

# OpenCost Setup

There are several supported ways of deploying OpenCost, depending on your use case and environment. Each cloud provider has different configuration requirements depending on your deployment. For full OpenCost functionality (Kubernetes Cost Allocations, Cloud Costs, and the web UI), we recommend deploying with Helm and following the instructions specific to your cloud provider:
* [Amazon Web Services](../configuration/aws)
* [Microsoft Azure](../configuration/azure)
* [Google Cloud Platform](../configuration/gcp)
* [Oracle Cloud Infrastructure](../configuration/oracle)
* [On-premises deployments](../configuration/on-prem)

## Requirements

OpenCost requires a Kubernetes cluster to be deployed. Users should be running Kubernetes 1.21+ and Kubernetes 1.28 is officially supported as of v1.105.

OpenCost requires [Prometheus](prometheus) for scraping metrics and data storage.

# Quick Start Installation

* Quick install: `kubectl manifest` for basic Kubernetes Cost Allocations without Cloud Costs on AWS or on-premises.
* Docker instructions: for accessing Cloud Costs without Kubernetes Cost Allocations.
* Prometheus OpenCost Exporter: Running OpenCost as a Prometheus metric exporter allows you to export various cost metrics to Prometheus, this does not include Cloud Costs or a web UI.

These commands will get you started immediately with OpenCost.

### Install Prometheus

<InstallPrometheus/>

### Install OpenCost

```sh
kubectl apply --namespace opencost -f https://raw.githubusercontent.com/opencost/opencost/develop/kubernetes/opencost.yaml
```

That is all that is required for most initial installations.

### Integrating Cloud Costs

If you want more accurate results or Cloud Costs from your provider's bill please refer to the [Cloud Service Provider Configuration](../configuration/) page. You will need to manage your deployment with the [Helm](helm) chart to configure this.

:::info

The Cloud Costs feature is included in the stable releases as of 1.108.0. Please ensure you have the latest release to access this new feature.

:::

## Testing

Once your OpenCost has been installed, wait for the pod to be ready and port forward with:

```sh
kubectl port-forward --namespace opencost service/opencost 9003 9090
```

To verify that the UI and server are running, you may access the OpenCost UI at [http://localhost:9090](http://localhost:9090).

To verify that the server is running, access [http://localhost:9003/allocation/compute?window=60m](http://localhost:9003/allocation/compute?window=60m)

### Testing with Kubectl Cost Plugin

For a curated, command line output, we recommend installing [kubectl cost](../integrations/kubectl-cost) plugin:

```sh
kubectl cost --service-port 9003 --service-name opencost --kubecost-namespace opencost --allocation-path /allocation/compute  \
    namespace \
    --window 5m \
    --show-efficiency=true
```

Output:

```
+---------+---------------+--------------------+-----------------+
| CLUSTER | NAMESPACE     | MONTHLY RATE (ALL) | COST EFFICIENCY |
+---------+---------------+--------------------+-----------------+
|         | opencost      |          18.295200 |        0.231010 |
|         | prometheus    |          17.992800 |        0.000000 |
|         | kube-system   |          11.383200 |        0.033410 |
+---------+---------------+--------------------+-----------------+
| SUMMED  |               |          47.671200 |                 |
+---------+---------------+--------------------+-----------------+
```

### Testing with OpenCost API

You can see here more [API Examples](../integrations/api)

## Updating OpenCost
To update your OpenCost to the most recent version, using a previously unmodified `opencost.yaml` manifest, enter the following command. This will update OpenCost to the latest version.

```sh
kubectl -n opencost rollout restart deployment
```

To check logs to verify the version of your OpenCost:

```sh
$  kubectl logs -n opencost deployment/opencost | head
2022-09-02T18:20:34.327989163Z ??? Log level set to info
2022-09-02T18:20:34.328206357Z INF Starting cost-model (git commit "x.xx.x")
```

### Sidegrading OpenCost
If you wish to modify OpenCost to a previous version, start with the following command in order to modify the `opencost.yaml` manifest:

In the line `quay.io/kubecost1/kubecost-cost-model:latest`, change `latest` to the desired version number in the format `prod-x.xx.x`. Then enter the following command to apply the updated `opencost.yaml` manifest:

```sh
$ kubectl apply -f opencost.yaml -n opencost
namespace/opencost unchanged
serviceaccount/opencost unchanged
clusterrole.rbac.authorization.k8s.io/opencost unchanged
clusterrolebinding.rbac.authorization.k8s.io/opencost unchanged
deployment.apps/opencost configured
service/opencost unchanged
```

Finally, check the logs to verify the version of your OpenCost has successfully been changed:

```sh
$  kubectl logs -n opencost deployment/opencost | head
2022-09-02T18:20:34.327989163Z ??? Log level set to info
2022-09-02T18:20:34.328206357Z INF Starting cost-model (git commit "x.xx.x")
```

## Deleting OpenCost
To delete OpenCost, enter the following command:

`kubectl delete -f https://raw.githubusercontent.com/opencost/opencost/develop/kubernetes/opencost.yaml`

## Help

Please let us know if you run into any issues, we are here to help!

Join us on [CNCF Slack](https://slack.cncf.io/) in the [#opencost](https://cloud-native.slack.com/archives/C03D56FPD4G) channel if you have questions or contact us via email (<opencost@kubecost.com>).
